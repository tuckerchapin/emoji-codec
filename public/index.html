<html>
  <head>
    <title>&#x1F603; &harr; :shortname:</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <style>
      :root {
        --base-text-weight-semibold: 600;
        --fontStack-monospace: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;

        color-scheme: light;
        --fgColor-default: #1f2328;
        --bgColor-default: #ffffff;
        --bgColor-muted: #f6f8fa;
        --bgColor-neutral-muted: #afb8c133;
        --color-prettylights-syntax-comment: #57606a;
        --color-prettylights-syntax-constant: #0550ae;
        --color-prettylights-syntax-constant-other-reference-link: #0a3069;
        --color-prettylights-syntax-entity: #6639ba;
        --color-prettylights-syntax-storage-modifier-import: #24292f;
        --color-prettylights-syntax-entity-tag: #0550ae;
        --color-prettylights-syntax-keyword: #cf222e;
        --color-prettylights-syntax-string: #0a3069;
        --color-prettylights-syntax-variable: #953800;
        --color-prettylights-syntax-brackethighlighter-unmatched: #82071e;
        --color-prettylights-syntax-brackethighlighter-angle: #57606a;
        --color-prettylights-syntax-invalid-illegal-text: #f6f8fa;
        --color-prettylights-syntax-invalid-illegal-bg: #82071e;
        --color-prettylights-syntax-carriage-return-text: #f6f8fa;
        --color-prettylights-syntax-carriage-return-bg: #cf222e;
        --color-prettylights-syntax-string-regexp: #116329;
        --color-prettylights-syntax-markup-list: #3b2300;
        --color-prettylights-syntax-markup-heading: #0550ae;
        --color-prettylights-syntax-markup-italic: #24292f;
        --color-prettylights-syntax-markup-bold: #24292f;
        --color-prettylights-syntax-markup-deleted-text: #82071e;
        --color-prettylights-syntax-markup-deleted-bg: #ffebe9;
        --color-prettylights-syntax-markup-inserted-text: #116329;
        --color-prettylights-syntax-markup-inserted-bg: #dafbe1;
        --color-prettylights-syntax-markup-changed-text: #953800;
        --color-prettylights-syntax-markup-changed-bg: #ffd8b5;
        --color-prettylights-syntax-markup-ignored-text: #eaeef2;
        --color-prettylights-syntax-markup-ignored-bg: #0550ae;
        --color-prettylights-syntax-meta-diff-range: #8250df;
        --color-prettylights-syntax-sublimelinter-gutter-mark: #8c959f;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          color-scheme: dark;
          --fgColor-default: #e6edf3;
          --bgColor-default: #0d1117;
          --bgColor-muted: #161b22;
          --bgColor-neutral-muted: #6e768166;
          --color-prettylights-syntax-comment: #8b949e;
          --color-prettylights-syntax-constant: #79c0ff;
          --color-prettylights-syntax-constant-other-reference-link: #a5d6ff;
          --color-prettylights-syntax-entity: #d2a8ff;
          --color-prettylights-syntax-storage-modifier-import: #c9d1d9;
          --color-prettylights-syntax-entity-tag: #7ee787;
          --color-prettylights-syntax-keyword: #ff7b72;
          --color-prettylights-syntax-string: #a5d6ff;
          --color-prettylights-syntax-variable: #ffa657;
          --color-prettylights-syntax-brackethighlighter-unmatched: #f85149;
          --color-prettylights-syntax-brackethighlighter-angle: #8b949e;
          --color-prettylights-syntax-invalid-illegal-text: #f0f6fc;
          --color-prettylights-syntax-invalid-illegal-bg: #8e1519;
          --color-prettylights-syntax-carriage-return-text: #f0f6fc;
          --color-prettylights-syntax-carriage-return-bg: #b62324;
          --color-prettylights-syntax-string-regexp: #7ee787;
          --color-prettylights-syntax-markup-list: #f2cc60;
          --color-prettylights-syntax-markup-heading: #1f6feb;
          --color-prettylights-syntax-markup-italic: #c9d1d9;
          --color-prettylights-syntax-markup-bold: #c9d1d9;
          --color-prettylights-syntax-markup-deleted-text: #ffdcd7;
          --color-prettylights-syntax-markup-deleted-bg: #67060c;
          --color-prettylights-syntax-markup-inserted-text: #aff5b4;
          --color-prettylights-syntax-markup-inserted-bg: #033a16;
          --color-prettylights-syntax-markup-changed-text: #ffdfb6;
          --color-prettylights-syntax-markup-changed-bg: #5a1e02;
          --color-prettylights-syntax-markup-ignored-text: #c9d1d9;
          --color-prettylights-syntax-markup-ignored-bg: #1158c7;
          --color-prettylights-syntax-meta-diff-range: #d2a8ff;
          --color-prettylights-syntax-sublimelinter-gutter-mark: #484f58;
        }
      }

      html {
        color: var(--fgColor-default);
        background-color: var(--bgColor-default);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      }

      body {
        margin: 0;
        padding: 0;
        height: 100vh;
        width: 100vw;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        row-gap: 32px;
        font-size: 16px;
      }

      h1 {
        line-height: 1em;
        margin: 0;
        white-space: nowrap;
      }

      code, pre {
        margin: 0;
        color: var(--fgColor-default);
        font-family: var(--fontStack-monospace, ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace);
        border-radius: 6px;
      }

      code {
        padding: 0 .2em;
        background-color: var(--bgColor-neutral-muted);
      }

      pre {
        padding: 16px;
        word-wrap: normal;
        word-break: normal;
        background-color: var(--bgColor-muted);
        font-size: 85%;
        line-height: 1.45;
        height: calc(1em * 1.45 * 8);
        width: 500px;
        overflow: scroll;
      }

      .pl-s {
        color: var(--color-prettylights-syntax-string);
      }

      .pl-en {
        color: var(--color-prettylights-syntax-entity);
      }

      .pl-c {
        color: var(--color-prettylights-syntax-comment);
      }

      .pl-ent {
        color: var(--color-prettylights-syntax-entity-tag);
      }

      .pl-c {
        color: var(--color-prettylights-syntax-comment);
      }

      #randomize {
        display: none;
      }

      label[for="randomize"] {
        cursor: pointer;
        font-size: 2em;
        user-select: none;
        -webkit-user-select: none;
      }
    </style>

    <script async>
      const baseUrl = 'https://tuckerchap.in/emoji-codec';
      let emojis = []

      const fetchEmojis = () => fetch(`${baseUrl}/emojis.json`)
        .then(res => res.json())
        .then(arr => arr.filter(({ shortname }) => !shortname.includes('::')))
        .then(arr => { emojis = arr; })
        ;

      const assignEmoji = ({ emoji, shortname, shortnames, variations }) => {
        document.querySelectorAll('span.emoji').forEach(n => n.innerText = emoji);
        document.querySelectorAll('a.emoji').forEach(n => n.href = `${baseUrl}/${emoji}`);

        document.querySelectorAll('span.shortname').forEach(n => n.innerText = shortname);
        document.querySelectorAll('a.shortname').forEach(n => n.href = `${baseUrl}/${shortname}`);

        const syntaxHighlightShortnames = arr => arr.map(s => `<span class="pl-s"><span class="pl-pds">"</span>${s}<span class="pl-pds">"</span></span>`).join('<span class="pl-pds">, </span>')
        document.querySelector('span#shortnames').innerHTML = syntaxHighlightShortnames(shortnames);

        document.querySelector('span#variations').innerHTML = JSON
          .stringify(variations.map(v => ({ ...v, shortnames: syntaxHighlightShortnames(v.shortnames) || [] })), null, 2)
          .split('\n')
          .map((line, i) => i === 0 ? line : '  ' + line) // indent all but the first line
          .map(l => {
            // highlight json
            if (l.includes(':')) {
              // highlight the lines containing key/value pairs
              return l.split(/:(.*)/s).map((s, i) => `<span class="pl-${i === 0 ? 'ent' : 's'}">${s}</span>`).slice(0, 2).join(':')
            }
            // highlight the braces and brackets
            return `<span class="pl-pds">${l}</span>`;
          })
          .join('\n')
          ;
      }

      const randomEmoji = () => {
        if (emojis.length === 0) {
          return fetchEmojis()
            .then(randomEmoji) // TODO backoff retries
            .catch(console.error)
            ;
        }

        assignEmoji(emojis[Math.floor(Math.random() * emojis.length)]);
      };

      fetchEmojis().catch(console.error);
    </script>
  </head>
  <body>
    <h1><span class="emoji">&#x1F603;</span> &harr; <code><span class="shortname">:shortname:</span></code></h1>
    <pre><span class="pl-c">&gt;</span> <span class="pl-en">GET</span> <a class="emoji pl-s" href="https://tuckerchap.in/emoji-codec/&#x1F603;">https://tuckerchap.in/emoji-codec/<span class="emoji">&#x1F603;</span></a>
<span class="pl-c">&gt;</span> <span class="pl-en">GET</span> <a class="shortname pl-s" href="https://tuckerchap.in/emoji-codec/:smiley:">https://tuckerchap.in/emoji-codec/<span class="shortname">:smiley:</span></a>
{
  <span class="pl-ent">"emoji"</span>: <span class="pl-s"><span class="pl-pds">"</span><span class="emoji">&#x1F603;</span><span class="pl-pds">"</span></span>,
  <span class="pl-ent">"shortname"</span>: <span class="pl-s"><span class="pl-pds">"</span><span class="shortname">:smiley:</span><span class="pl-pds">"</span></span>,
  <span class="pl-ent">"shortnames"</span>: [<span id="shortnames"></span>],
  <span class="pl-ent">"variations"</span>: <span id="variations">[]</span>
}</pre>
    <label for="randomize">&#x1F500;</label>
    <button id="randomize" onclick="randomEmoji()"/>
  </body>
</html>